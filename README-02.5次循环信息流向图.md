# 次循环信息流向图

## 概览
次循环负责感知外部信息和执行人格化行动，包含映射层和感知接口。它是智能体与外部世界的交互界面，具有螺旋上升的哲学属性。

---

## 1. 次循环整体信息流

```
┌─────────────────────────────────────────────────────────────┐
│                  次循环（行动感知系统）                        │
│                  螺旋上升，持续进化                           │
└─────────────────────────────────────────────────────────────┘

                    ┌─────────────┐
                    │   映射层    │ ◄─── 哲学洞察（记录层）
                    │  （人格核心）│
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │   双向信息传递           │
              │   • 行动指令（映射→感知）│
              │   • 感知数据（感知→映射）│
              └────────────┬────────────┘
                           ↓
                    ┌─────────────┐
                    │  感知接口   │
                    │ (Tool Use)  │
                    └──────┬──────┘
                           │
              ┌────────────┴────────────┐
              │    单向信息流            │
              │    • 即时性反馈          │
              │    • 实效性反馈          │
              └────────────┬────────────┘
                           ↓
                    ┌─────────────┐
                    │ 自我迭代顶点│
                    │  （主循环）  │
                    └─────────────┘

```

### 次循环信息流向总览

| 起点 | 终点 | 数据类型 | 方向 |
|------|------|---------|------|
| 记录层 | 映射层 | 哲学洞察 | 单向 |
| 映射层 | 感知接口 | 行动指令 | 双向 |
| 感知接口 | 映射层 | 感知数据（结构化） | 双向 |
| 映射层 | 自我迭代顶点 | 即时性、实效性反馈 | 单向 |

---

## 2. 映射层信息流

```
┌─────────────────────────────────────────────────────────────┐
│                      映射层（人格核心）                        │
│                 将符号思考人格化，转化为个性化行动              │
└─────────────────────────────────────────────────────────────┘

输入源
  │
  ├─ 记录层（哲学洞察）────────────────────────┐
  │   • 价值偏好                                │
  │   • 成功模式                                │
  │   • 元认知洞察                              │
  │   • 客观性模式                              │
  │                                             │
  ├─ 主循环（符号系统推理结果）──────────────────┤
  │   • 逻辑推理结果                            │
  │   • 抽象行动方案                            │
  │                                             │
  └─ 感知接口（外部数据）───────────────────────┘
      • 结构化感知数据
      • 工具执行结果
      │
      ↓
┌──────────────────────────────────────────────┐
│          映射层处理流程                        │
│                                               │
│  1. 需求层次映射                              │
│     → 感知数据 → 需求识别 → 优先级计算        │
│     → 基于马斯洛需求层次（5层）               │
│     → 根据人格调整激活强度                    │
│     → 根据历史成功率计算优先级                │
│                                               │
│  2. 人格化决策                                │
│     → 符号系统："怎么做是合理的"              │
│     → 映射层："怎么做符合我"                  │
│     → 基于大五人格（5维度）                   │
│     → 转化为个性化行动                        │
│                                               │
│  3. 即时性与实效性评估                        │
│     → 计算系统响应速度（0-10分）              │
│     → 计算目标达成程度（0-10分）              │
│                                               │
│  4. 进化建议生成                              │
│     → 效率优化建议                            │
│     → 准确性提升建议                          │
│     → 人格调整建议                            │
│                                               │
│  5. 元认知决策（新增）                        │
│     → 接收客观特征标注                        │
│     → 基于马斯洛需求和人格特质决策            │
│     → 动态调整触发阈值                        │
│     → 生成决策指令（trigger_reflection）      │
└──────────────────────────────────────────────┘
      │
      ↓ 输出
  输出流
  │
  ├─→ 感知接口（行动指令）
  │   • 工具调用请求
  │   • 参数传递
  │   • 执行控制
  │
  └─→ 自我迭代顶点（行为反馈）
      • 即时性评分（0-10）
      • 实效性评分（0-10）
      • 人格反馈
      • 进化建议

```

### 映射层数据结构

#### 人格向量（大五人格）

```python
{
  "openness": 0.5,           # 开放性：创新与探索倾向
  "conscientiousness": 0.5,  # 尽责性：稳定与可靠倾向
  "extraversion": 0.5,       # 外向性：社交与互动倾向
  "agreeableness": 0.5,      # 宜人性：合作与认同倾向
  "neuroticism": 0.3         # 神经质：焦虑与规避倾向
}
```

#### 马斯洛需求权重

```python
{
  "physiological": 0.8,      # 生理需求
  "safety": 0.8,             # 安全需求
  "belonging": 0.6,          # 归属需求
  "esteem": 0.6,             # 尊重需求
  "self_actualization": 0.5  # 自我实现需求
}
```

### 映射层信息流向详解

| 起点 | 终点 | 数据类型 | 方向 | 功能 |
|------|------|---------|------|------|
| 记录层 | 映射层 | 哲学洞察 | 单向 | 提供历史经验指导 |
| 主循环（数学顶点） | 映射层 | 逻辑推理结果 | 单向 | 接收符号系统推理 |
| 感知接口 | 映射层 | 感知数据 | 双向 | 获取外部状态 |
| 映射层 | 感知接口 | 行动指令 | 双向 | 控制外部行动 |
| 映射层 | 自我迭代顶点 | 即时性、实效性反馈 | 单向 | 提供行为反馈 |
| 认知架构洞察 | 映射层 | 策略优化洞察 | 单向 | 接收进化指导 |
| 客观性评估器 | 映射层 | 客观特征标注 | 单向 | 元认知决策输入 |

### 需求层次映射示例

```
感知数据输入
    ↓
需求识别
    ├─ 感知到威胁 → 激活安全需求（强度0.9）
    ├─ 感知到挑战 → 激活自我实现需求（强度0.7）
    ├─ 感知到社交 → 激活归属需求（强度0.6）
    └─ 感知到资源 → 激活生理需求（强度0.8）
    ↓
人格调整
    ├─ 高尽责性：安全需求权重×1.2
    ├─ 高开放性：自我实现需求权重×1.3
    └─ 高宜人性：归属需求权重×1.1
    ↓
优先级计算
    ├─ 基于历史成功率调整
    └─ 基于当前紧急程度调整
    ↓
输出优先级列表
```

### 人格化决策示例

```
符号系统建议："向左移动"
    ↓
人格化处理
    ├─ 高尽责性 → "谨慎地向左移动，速度适中"
    ├─ 高开放性 → "大胆向左移动，探索新路径"
    ├─ 高宜人性 → "向左移动，注意周围环境"
    └─ 高外向性 → "快速向左移动，准备互动"
    ↓
输出个性化行动
```

---

## 3. 感知接口信息流

```
┌─────────────────────────────────────────────────────────────┐
│                    感知接口（Tool Use）                       │
│                智能体与外部世界的标准化接口                    │
└─────────────────────────────────────────────────────────────┘

接收指令
  │
  ├─ 映射层（行动指令）
  │   • 工具名称
  │   • 参数列表
  │   • 执行控制
  │
  └─ 主循环（推理结果）
      • 工具调用请求
      │
      ↓
┌──────────────────────────────────────────────┐
│          感知接口处理流程                      │
│                                               │
│  1. 参数验证                                  │
│     → 检查参数类型、范围、必需性              │
│     → 内置参数验证机制                        │
│                                               │
│  2. 工具调用                                  │
│     → 调用具体工具（web_search/file_read等）  │
│     → 获取原始数据                            │
│                                               │
│  3. 数据处理                                  │
│     → 消除噪音                                │
│     → 结构化转换                              │
│     → 错误处理                                │
│     → 重试机制（可选）                        │
│                                               │
│  4. 标准化输出                                │
│     → 统一返回格式                            │
│     → 状态明确（success/error）               │
│     → 包含元数据                              │
└──────────────────────────────────────────────┘
      │
      ↓ 输出
  输出流
  │
  ├─→ 映射层（结构化数据）
  │   • success: true/false
  │   • status: "success"/"error"
  │   • data: {}
  │   • error: {}
  │   • metadata: {}
  │
  └─→ 主循环（推理输入）
      • 清晰的无噪音数据
      • 可直接用于推理

```

### 感知接口数据流向详解

| 起点 | 终点 | 数据类型 | 方向 | 功能 |
|------|------|---------|------|------|
| 映射层 | 感知接口 | 行动指令 | 双向 | 发起工具调用 |
| 主循环 | 感知接口 | 工具调用请求 | 单向 | 推理需要数据 |
| 感知接口 | 映射层 | 结构化数据 | 双向 | 返回感知结果 |
| 感知接口 | 主循环 | 清晰数据 | 单向 | 提供推理输入 |
| 外部工具 | 感知接口 | 原始数据 | 单向 | 工具执行结果 |

### 感知接口标准化输出格式

```python
{
  "success": true/false,
  "status": "success/error",
  "data": {},              # 成功时的数据
  "error": {},             # 失败时的错误信息
  "metadata": {
    "tool_name": "web_search",
    "execution_time_ms": 127,
    "timestamp": "2025-02-22T10:30:00Z",
    "retry_count": 0
  }
}
```

### 感知接口工具类型

| 工具类型 | 功能 | 输入 | 输出 |
|---------|------|------|------|
| web_search | 网络搜索 | 查询关键词 | 搜索结果（结构化） |
| file_read | 文件读取 | 文件路径 | 文件内容 |
| calculator | 数学计算 | 表达式 | 计算结果 |
| get_weather | 天气查询 | 地点信息 | 天气数据 |

---

## 4. 次循环与主循环交互信息流

```
┌─────────────────────────────────────────────────────────────┐
│           次循环与主循环交互（跨系统信息流）                   │
└─────────────────────────────────────────────────────────────┘

┌────────────────────────┐
│        主循环          │
│   （符号系统循环）     │
│                        │
│   记录层 ──────────┐   │
│     ↓               │   │
│   三角形循环        │   │
│     ↓               │   │
│   数学顶点 ─────────┼───┼──→ 认知架构洞察 → 映射层
│                      │   │
└──────────────────────┼───┘
                       │
         ┌─────────────┴─────────────┐
         │                           │
         ↓                           ↓
┌──────────────────┐       ┌──────────────────┐
│     次循环       │       │   认知架构洞察    │
│   （行动感知）    │       │  （独立组件）     │
│                  │       │                  │
│  记录层 ←─────────┼───────┤   数学 → 洞察   │
│    ↑              │       │      ↓          │
│  映射层 ←─────────┼───────┤   映射层        │
│    ↑              │       │   自我迭代      │
│  感知接口         │       └──────────────────┘
│    ↑              │
│  外部世界         │
└──────────────────┘

关键交互点：
1. 记录层 → 映射层：哲学洞察（单向）
2. 数学顶点 → 认知架构洞察：结构化模式（单向）
3. 认知架构洞察 → 映射层：策略优化洞察（单向）
4. 认知架构洞察 → 自我迭代：架构升级洞察（单向）
5. 映射层 → 自我迭代顶点：即时性、实效性反馈（单向）
6. 映射层 → 客观性评估器：决策指令（单向，元认知）
```

### 跨系统信息流向详解

| 起点 | 终点 | 数据类型 | 方向 | 用途 |
|------|------|---------|------|------|
| 主循环记录层 | 映射层 | 哲学洞察 | 单向 | 提供历史经验指导 |
| 主循环数学顶点 | 认知架构洞察 | 结构化模式 | 单向 | 提取进化洞察 |
| 认知架构洞察 | 映射层 | 策略优化洞察 | 单向 | 指导行为优化 |
| 认知架构洞察 | 自我迭代顶点 | 架构升级洞察 | 单向 | 指导架构进化 |
| 映射层 | 自我迭代顶点 | 即时性、实效性 | 单向 | 提供行为反馈 |
| 映射层 | 主循环数学顶点 | 行动指令结果 | 单向 | 提供推理输入 |

---

## 5. 即时性与实效性评估流程

```
┌─────────────────────────────────────────────────────────────┐
│              即时性与实效性评估（映射层核心功能）              │
└─────────────────────────────────────────────────────────────┘

行动执行完成
    ↓
┌──────────────────────────────────────────────┐
│        即时性评估（响应速度）                   │
│                                              │
│  执行时间 → 即时性评分（0-10分）              │
│                                              │
│  评分规则：                                   │
│  • <100ms: 10分                              │
│  • <500ms: 9分                               │
│  • <1s: 8分                                  │
│  • <2s: 7分                                  │
│  • <5s: 6分                                  │
│  • >=5s: 5分                                 │
└──────────────────────────────────────────────┘
    ↓
┌──────────────────────────────────────────────┐
│        实效性评估（目标达成）                   │
│                                              │
│  目标达成程度 → 实效性评分（0-10分）          │
│                                              │
│  评分规则：                                   │
│  • 完全达成: 10分                            │
│  • 部分达成: 5-8分                           │
│  • 失败: 0分                                 │
└──────────────────────────────────────────────┘
    ↓
┌──────────────────────────────────────────────┐
│        进化建议生成                            │
│                                              │
│  基于即时性和实效性，生成建议：               │
│  • 效率优化建议                              │
│  • 准确性提升建议                            │
│  • 人格调整建议                              │
└──────────────────────────────────────────────┘
    ↓
输出反馈给自我迭代顶点
```

### 评估示例

```
场景：执行web_search搜索"AGI架构"

执行时间：350ms
    ↓
即时性评分：9分（<500ms）
    ↓
目标达成：成功返回相关结果
    ↓
实效性评分：10分（完全达成）
    ↓
生成建议：
    • 效率优化："当前响应速度优秀，建议保持"
    • 准确性提升："搜索结果准确度良好"
    • 人格调整："无需调整"
    ↓
反馈给自我迭代顶点
```

---

## 6. 次循环超然性特征

### 螺旋上升

- 每次交互都基于历史经验（从记录层获取哲学洞察）
- 人格特质随时间进化（向自我迭代顶点提供反馈）
- 决策质量持续提升（基于即时性和实效性评估）

### 独立性

- 映射层独立于主循环推理过程
- 感知接口独立处理外部交互
- 不直接参与三角形顶点循环

### 桥梁作用

- 连接符号系统（主循环）与外部世界
- 将抽象推理转化为具体行动
- 将外部数据转化为内部符号

---

## 总结

### 次循环信息流向特征

| 特征 | 描述 |
|------|------|
| 核心组件 | 映射层（人格核心）+ 感知接口（Tool Use） |
| 信息流向 | 映射层 ↔ 感知接口（双向），映射层 → 自我迭代（单向） |
| 超然性 | 独立于主循环，螺旋上升，持续进化 |
| 桥梁作用 | 连接符号系统与外部世界 |
| 反馈机制 | 即时性 + 实效性 → 自我迭代顶点 |

### 设计优势

- **人格化行动**：将符号思考转化为个性化行动
- **双向交互**：感知接口支持双向信息传递
- **标准化接口**：统一的数据格式，降低噪音
- **持续进化**：基于反馈持续优化人格和行为
- **独立决策**：映射层拥有最终决策权
